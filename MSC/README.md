This folder contains code for MSC encoding/decoding

The host and device code is a modified version of the ESP-IDF host and device examples which can be found here:

[USB-MSC Host Example](https://github.com/espressif/esp-idf/tree/master/examples/peripherals/usb/host/msc)

[USB-MSC Device Example](https://github.com/espressif/esp-idf/tree/master/examples/peripherals/usb/device/tusb_msc_)


| MSC Module B | Description | MSC Module A | Description |
| :-------: | :------ | :-------: | :------- |
| -------------  | x | `dev_main_V9` | <ul><li>Addition of handshake retrigger upon checksum failure</li><li>Updating handshake protocol to match function of handshake retrigger</li><li>NOTE: New functions may have to be created to correctly outline USB desciptors from thsi point as SCSI bridge over UART appears to be functional with a delay of 70ms. Majority of the delay comes from the software with only a 10ms over the UART bridge</li></ul> |
| `host_main_V8` | <ul><li>Creation of a handshake retrigger function when handshake received from Module A</li><li>Update of handshake protocol and UART rx task to process handshake retrigger and to detect handshake on UART</li></ul>| `dev_main_V8` | <ul><li>Addition of high byte and low byte to match host_main frames</li><li>Updating READ10 and WRITE10 to copy sector to laptop after removing LBA and running checksum</li></ul>|
| `host_main_V7` | <ul><li>Creation of LBA for sector data to match with Module A information</li><li>Reconfiguration of tx_frame to match new addition of LBA high and low bytes</li><li>sector data format matched with Module A</li></ul> | `dev_main_V7` | <ul><li>ADdition of print_tx_frame and print_rx_frame as used in host_main</li><li>Creation of send_frame for which includes a header frame, type, payload length and checksum</li><li>Updated SCSI commands to match new send_frame function</li><li>Removal of tusb configuration descriptors as configuration errors still present</li><li>Inclusion of handshake task to match host_main handshake</li></ul> |
| `host_main_V6` | <ul><li>Creation of print_rx_frame and print_tx_frame for easier serial monitor printing</li><li>Addition of header, checksum and LBA to READ10 sectors, addition of header, checksum and ack to WRITE10 sectors</li><li>Conversion of handshake protocol from Arduino IDE into VSCODE</li></ul> | `dev_main_V6` | <ul><li>Addition of tusb_desc_device_t descriptors to try and resolve device configuration issues on laptop alongside string descriptors and configuration descriptors</li><li>Attempted simplification of SCSI commands to directly send CBW and CSW through a queue to reduce latency times</li><li>Creation of MSC worker task for data being received and sent to minimise latency</li><li>Removal of storage configuration</li></ul> |
| `host_main_V5` | <ul><li>Inclusion of USB-MSC peripheral 'queue' from ESP-IDF example for full USB flash-drive mounting functionality</li><li>Addition of main loop from ESP-IDf example into main=</li></ul> | `dev_main_V5` | x |
| `host_main_V4` | <ul><li>Validate checksum function created for checksum error correciton, similar to HID</li><li>UART rx task started using printf to print to serial monitors</li><li>scsi_cmd used for READ10 and WRITE10 sectors</li><li>MSC event cb and USB task kept from ESP-IDF example, fopen and fread functions removed for MSC block data transfer</li></ul> | `dev_main_V4` | <ul><li>UART set up moved to separate uart_init task</li><li>Correct framing for SCSI sectors added including start byte, SCSI type, payload, LBA and checksum</li><li>Implementation of SPI flashing from ESP-IDF example into app_main</li></ul> |
| `host_main_V3` | <ul><li>Inclusion of host example USB mounting alongside UART bridge</li><li>usb_task developed, msc_event_cb included alongside other functions required for fopen and fread</li></ul> | `dev_main_V3` | <ul><li>Creation of tud_msc_read10 and tud_msc_write10, tud_msc_inquiry_cb MSC callbacks with basic sector data sending and receiving</li><li>Customer headers added to both READ10 and WRITE10 sector data</li><li>cleaned up comments</li></ul> |
| `host_main_V2` | <ul><li>Creation of USB host task</li><li>Preliminary inclusion of SCSI commands including inquiry, read & write</li></ul> | `dev_main_V2` | <ul><li>Addition of tud device descriptors</li><li>Capacity check for other board & msc device checks</li></ul> |
| `host_main_V1` | <ul><li>UART bridge</li><li>Initial USB flash-drive mounting</li><li>Testing of msc_host_read_sector for extracting data blocks</li></ul> | `dev_main_V1` | <ul><li>UART bridge</li><li>tud_msc read10 & write10 reading and preliminary writing</li><li>USB device configuration parameters</li></ul> |

